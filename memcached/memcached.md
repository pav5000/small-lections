# Memcached

Это просто большая мапка в памяти.
Данные хранятся только в пямяти, никакого сброса на диск.
В целом, это можно рассматривать как "ненадежное, но **очень** быстрое key-value хранилище"

## Запускаем

sudo docker run --rm -ti --network host --name memcache memcached memcached -m 64 -vvv

Рассмотрим команду запуска подробнее.
`docker run` -- запустить докер-контейнер
`--rm` -- удалить контейнер при завершении его работы, чтобы не засорять комп
`-ti` -- показать нам консоль
`--network host` -- отключить докеровский NAT, чтобы приложение имело доступ к сети напрямую
`--name memcache` -- назовем наш контейнер memcache
`memcached` -- имя образа, из которого мы создаем контейнер. Это стандартный образ Мемкэша из репы Докера.
`memcached -m 64 -vvv` -- какую команду запустить внутри контейнера. Тут мы запускаем сам мемкэш, говорим ему использовать 65Мб памяти и включить verbose-режим (чтобы он писал о всех операциях в консоль).

Можем еще указать параметры:
`-l 127.0.0.1` -- слушать только локалхост
`-p 11211` -- слушать на определенном порту (11211 принят по-умолчанию)
`-n 48` -- сколько байт синимально аллоцировать под одну запись. Уменьшение этого значения может уменьшить потребление памяти при куче мелких ключей.
`-C` -- выключить Compare and swap (уменьшает размер записи на 8 байт).
`-I 1m` -- размер одного блока в памяти. Одна запись не может быть больше, чем этот размер.

**Важно:** при старте мемкэш сразу занимает всю память, которую мы ему указали в параметре `-m`. Это сделано для оптимизации.

## Смотрим на протокол

Ключ -- текстовая строка длиной до 250 байт. Запрещены контрольные символы и пробелы.
![dont](https://imgflip.com/i/51wax2)

Значение -- любые бинарные данные.

# Команды

Сохранение данных:
- `set` используем только ее, тупо создает или заменяет запись
- `add`
- `replace`
- `append`
- `prepend`
- `cas`

